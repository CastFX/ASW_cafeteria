<!DOCTYPE html>
<html lang="it">
<head>

  <title>Tickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="static/css/reset.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="static/js/qrcode.min.js"></script>
  <link rel="stylesheet" href="static/css/ticket.css">
</head>

<body>
<div id="app">

  <div v-cloak v-if="dataReady">
    <div class='container' id ='ticketList'>
      <div class='row'>
    	   <div class='col-md-6' v-for="item in tickets">
    			   <div class='media'>
    				       <div class='media-left'>
    					            <img class='media-object' v-bind:src=item.idTipoTicket.image v-bind:alt=item.idTipoTicket.type data-toggle="modal" data-target=".bd-example-modal-sm" @click="loadQR(item)">
                          <!-- Small modal -->

                          <div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-sm">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h4 class="modal-title" id="mySmallModalLabel">Make it scan to coffee boi</h4>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">Ã—</span>
                                  </button>
                                </div>
                                <div class="modal-body">
                                  <div id="qrcode"></div>
                                </div>
                              </div>
                            </div>
                          </div>
    					     </div>
    					<div class='media-body'>
    					       <h3 class='media-heading'>
    						             <b>{{item.idTipoTicket.type}} del {{item.idTipoTicket.discount}}%</b>
    						     </h3>
    					       <p class="media-desc">{{item.idTipoTicket.description}}</p>
    					</div>
    				</div>
        </div>
      </div>
    </div>
  </div>

  <div class="text-center" v-if="!dataReady">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

</div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://npmcdn.com/vue-router/dist/vue-router.js"></script>
<script>

var tickets = {
  _id:'',
  idTipoTicket: {
    type:'',
    discount:'',
    description:'',
    image:''
  }
};

var app = new Vue({
	el:	"#app",
	data:	{
		tickets: tickets,
    dataReady: false,
	},
	methods: {
    loadQR: function(item){
        document.getElementById("qrcode").innerHTML = "";
        new QRCode(document.getElementById("qrcode"), item._id);
    },
		listTicket: function(){
			axios.get("api/userTickets")
				.then(response => {this.tickets = response.data; this.dataReady = true}) //Promise
				.catch(error => (console.log(error))) //Gestione errori approssimativa
		},
		init: function(){
			this.listTicket();
		}
	},
	mounted(){
		this.init();
	}
});
</script>

</html>
